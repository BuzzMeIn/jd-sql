# jd-sql
select *  from  (select distinct eph.div_nm as Division,    eph.platform_nm as Platform,    eph.prod_line_nm as Product_Line,    eph.prod_fam_nm as Product_Family,    eph.prod_fam_sub_cat_nm as Product_Sub_Family,    eph.series_nm as Series,    eph.decal_model_nm as Decal_Model,    wg.SALES_CHANNEL_ID as SALES_CHANNEL_ID,    ma.SALES_CHANNEL_NAME as SALES_CHANNEL_NAME,    wg.BASE_CODE as Base_Code,    NULL as Attachment,    NULL as ATTCH_TYP_DSC,    NULL as OPT_CODE,     wg.DSC_BC as Description,    wg.BASE_AVLBLTY_STATUS as CNFG_STATE,    wg.ALDI_DT_BC as ALDI,    pp.CRNCY as Currency,    pp.PRC_START_DATE as price_start_date,    lead(pp.PRC_START_DATE, 1, current_date()) over (partition by pp.SALES_CHANNEL_ID, pp.BASE_CODE_ID order by pp.PRC_START_DATE) as price_end_date,    --DATEADD(DAY, -1, lead(pp.PRC_START_DATE, 1, current_date()) over (partition by pp.SALES_CHANNEL_ID, pp.BASE_CODE_ID order by pp.PRC_START_DATE)) as price_end_date,    --date_sub(lead(pp.PRC_START_DATE, 1, current_date()) over (partition by pp.SALES_CHANNEL_ID, pp.BASE_CODE_ID order by pp.PRC_START_DATE), 1) as price_end_date,    pp.LST_PRIC as list_price,    wg.DLR_VSBLTY_START_DATE_BC as dealer_visibility_start_date,    lead(wg.DLR_VSBLTY_START_DATE_BC, 1, current_date()) over (partition by wg.SALES_CHANNEL_ID, wg.BASE_CD_ID, pp.PRC_START_DATE order by wg.DLR_VSBLTY_START_DATE_BC) as dealer_visibility_end_date,    --DATEADD(DAY, -1, lead(wg.DLR_VSBLTY_START_DATE_BC, 1, current_date()) over (partition by wg.SALES_CHANNEL_ID, wg.BASE_CD_ID, pp.PRC_START_DATE order by wg.DLR_VSBLTY_START_DATE_BC)) as dealer_visibility_end_date,    --date_sub(lead(wg.DLR_VSBLTY_START_DATE_BC, 1, current_date()) over (partition by wg.SALES_CHANNEL_ID, wg.BASE_CD_ID, pp.PRC_START_DATE order by wg.DLR_VSBLTY_START_DATE_BC), 1) as dealer_visibility_end_date,    NULL as LIST_CNTRY_PRICE,    NULL as IS_A2P,    NULL as Status  from edl_current.core_product_master_ephexternal as eph  join edl.lppi_wholegood_prod_1_0_3 as wg  on eph.bmc_nm = wg.BASE_CODE  and eph.decal_model_id = wg.PI_DCL_MDL_ID JOIN (SELECT DISTINCT     BASE_CODE,     SALES_CHANNEL_ID,     MAX(EXTRACT_TIME) AS EXTRACT_TIME,     MAX(LPPI_PGM_VER_ID) AS LPPI_PGM_VER_ID     FROM EDL.lppi_wholegood_prod_1_0_3     --WHERE BASE_CODE IN ('578AM')     WHERE SALES_CHANNEL_ID in ('1033', '1007', '1037', '1042')     --AND SALES_CHANNEL_ID in ('1033', '1007', '1037','1042')     GROUP BY BASE_CODE, SALES_CHANNEL_ID) wg2   ON wg.BASE_CODE = wg2.BASE_CODE   AND wg.SALES_CHANNEL_ID = wg2.SALES_CHANNEL_ID   AND wg.LPPI_PGM_VER_ID = wg2.LPPI_PGM_VER_ID   AND wg.EXTRACT_TIME = wg2.EXTRACT_TIME join edl.lppi_base_code_price_prod_1_0_0 as pp  on wg.BASE_CD_ID = pp.BASE_CODE_ID  and wg.SALES_CHANNEL_ID = pp.SALES_CHANNEL_ID  join edl.MOCI_AREA_INFO_1_0_3 as ma  on wg.SALES_CHANNEL_ID = ma.SALES_CHANNEL_ID  where pp.PRC_START_DATE &lt;= current_date()  --and wg.BASE_CODE IN ('578AM') and wg.BASE_AVLBLTY_STATUS not in ('U')  and wg.SALES_CHANNEL_ID in ('1033', '1007', '1037','1042')  ) as a  where a.price_start_date != a.price_end_date  union all  select *   from  (select distinct eph.div_nm as Division,    eph.platform_nm as Platform,    eph.prod_line_nm as Product_Line,    eph.prod_fam_nm as Product_Family,    eph.prod_fam_sub_cat_nm as Product_Sub_Family,    eph.series_nm as Series,    eph.decal_model_nm as Decal_Model,    wg.SALES_CHANNEL_ID as SALES_CHANNEL_ID,    ma.SALES_CHANNEL_NAME as SALES_CHANNEL_NAME,    wg.BASE_CODE as Base_Code,    NULL as Attachment,    NULL as ATTCH_TYP_DSC,    wg.OPT_CODE as OPT_CODE,      wg.DSC_OC as Description,    wg.OPT_CODE_CNFG_STATE as CNFG_STATE,    NULL as ALDI,    pp.CRNCY as Currency,    pp.PRC_START_DATE as price_start_date,    lead(pp.PRC_START_DATE, 1, current_date()) over (partition by pp.SALES_CHANNEL_ID, pp.OPT_CODE_ID, pp.BASE_CODE_ID order by pp.PRC_START_DATE) as price_end_date,    pp.LST_PRIC as list_price,    wg.DLR_VSBLTY_START_DATE_OC as dealer_visibility_start_date,    lead(wg.DLR_VSBLTY_START_DATE_OC, 1, current_date()) over (partition by wg.SALES_CHANNEL_ID, wg.OPT_CODE_ID, wg.BASE_CD_ID, pp.PRC_START_DATE order by wg.DLR_VSBLTY_START_DATE_OC) as dealer_visibility_end_date,    NULL as LIST_CNTRY_PRICE,    NULL as IS_A2P,    NULL as Status  from edl_current.core_product_master_ephexternal as eph  join edl.lppi_wholegood_prod_1_0_3 as wg  on eph.bmc_nm = wg.BASE_CODE  and eph.decal_model_id = wg.PI_DCL_MDL_ID    --/////////////////////////////////////////////////////// JOIN (SELECT DISTINCT     BASE_CODE,     OPT_CODE,     SALES_CHANNEL_ID,     MAX(EXTRACT_TIME) AS EXTRACT_TIME,     MAX(LPPI_PGM_VER_ID) AS LPPI_PGM_VER_ID     FROM EDL.lppi_wholegood_prod_1_0_3     --WHERE BASE_CODE IN ('578AM')     WHERE SALES_CHANNEL_ID in ('1033', '1007', '1037', '1042')     --AND SALES_CHANNEL_ID in ('1033', '1007', '1037','1042')     GROUP BY BASE_CODE, OPT_CODE, SALES_CHANNEL_ID) wg2   ON wg.BASE_CODE = wg2.BASE_CODE   AND wg.OPT_CODE = wg2.OPT_CODE   AND wg.SALES_CHANNEL_ID = wg2.SALES_CHANNEL_ID   AND wg.LPPI_PGM_VER_ID = wg2.LPPI_PGM_VER_ID   AND wg.EXTRACT_TIME = wg2.EXTRACT_TIME  --/////////////////////////////////////////////////////// join edl.lppi_option_code_price_prod_1_0_0 as pp  on wg.BASE_CD_ID = pp.BASE_CODE_ID  and wg.OPT_CODE_ID = pp.OPT_CODE_ID and wg.SALES_CHANNEL_ID = pp.SALES_CHANNEL_ID  join edl.MOCI_AREA_INFO_1_0_3 as ma  on wg.SALES_CHANNEL_ID = ma.SALES_CHANNEL_ID   where pp.PRC_START_DATE &lt;= current_date()  and wg.OPT_CODE_CNFG_STATE not in ('U')  and wg.BASE_AVLBLTY_STATUS not in ('U')  and wg.SALES_CHANNEL_ID in ('1033', '1007', '1037','1042')  --and wg.BASE_CODE IN ('578AM') ) as a  where a.price_start_date != a.price_end_date  --AND a.BASE_CODE IN ('578AM') union  select *  from   (select distinct    eph.div_nm as Division,  eph.platform_nm as Platform,  eph.prod_line_nm as Product_Line,  eph.prod_fam_nm as Product_Family, eph.prod_fam_sub_cat_nm as Product_Sub_Family,  eph.series_nm as Series,  eph.decal_model_nm as Decal_Model,  la.SALES_CHANNEL_ID as SALES_CHANNEL_ID,  ma.SALES_CHANNEL_NAME as SALES_CHANNEL_NAME,  la.BASE_CODE as Base_Code,  ap.PART_NUMBER as Attachment,  la.ATTCH_TYP_DSC as ATTCH_TYP_DSC,  NULL as OPT_CODE,   mam.ATTCH_DESC as Description,   la.ATTCH_CNFG_STATE as CNFG_STATE,  NULL as ALDI,  lap.CRNCY as Currency,  ap.PRICE_EFF_DATE as price_start_date,  lead(ap.PRICE_EFF_DATE, 1, current_date()) over (partition by la.SALES_CHANNEL_ID, ap.PART_NUMBER, la.BASE_CODE order by ap.PRICE_EFF_DATE) as price_end_date,  lap.LST_PRIC as list_price,  la.DLR_VSBLTY_START_DATE as dealer_visibility_start_date,  lead(la.DLR_VSBLTY_START_DATE, 1, current_date()) over (partition by la.SALES_CHANNEL_ID, la.BASE_CODE, ap.PRICE_EFF_DATE order by la.DLR_VSBLTY_START_DATE) as dealer_visibility_end_date,  ap.LIST_CNTRY_PRICE as LIST_CNTRY_PRICE,  mam.IS_A2P as IS_A2P,  mam.STAT as Status  from sabd.attach_price ap  left outer join edl.MOCI_ATTACHMENT_MASTER_1_0_0 mam  on TRIM(ap.PART_NUMBER) = TRIM(mam.ATTCH_NUM)  left outer join edl.LPPI_ATTACHMENT_PROD_1_0_0 la  on TRIM(ap.PART_NUMBER) = TRIM(la.ATTCH_NUM)  left outer join edl.LAPI_ATTCH_PRIC_1_0_1 lap  on TRIM(ap.PART_NUMBER) = TRIM(lap.ATTCH_NUM)  and la.SALES_CHANNEL_ID = lap.SALES_CHANNEL_ID  left outer join edl_current.core_product_master_ephexternal as eph  on la.BASE_CODE = eph.bmc_nm  left outer join edl.MOCI_AREA_INFO_1_0_3 as ma  on la.SALES_CHANNEL_ID = ma.SALES_CHANNEL_ID  where ap.PRICE_EFF_DATE &lt;= current_date()  --AND la.BASE_CODE IN ('578AM') and ma.SALES_CHANNEL_NAME in ('A&amp;T Canada', 'A&amp;T United States', 'C&amp;F United States', 'C&amp;F Canada')  ) as a WHERE Trim(Attachment) = 'BUC10699'   AND a.SALES_CHANNEL_ID in ('1033', '1007', '1037','1042')    ORDER BY a.SALES_CHANNEL_ID,  a.BASE_CODE, OPT_CODE, price_start_date
